# SQL Scripts for Migrations from the Last 30 Days

Based on the migration files from August 7, 2025 to September 11, 2025, here are the SQL commands that would be executed:

## 1. Initial Crates Types Table Creation (2025-08-07)

```sql
CREATE TABLE [CratesTypes] (
    [Id] int NOT NULL IDENTITY,
    [Cratestype] nvarchar(max) NOT NULL,
    [Width] nvarchar(max) NOT NULL,
    [Height] nvarchar(max) NOT NULL,
    [Length] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_CratesTypes] PRIMARY KEY ([Id])
);
```

## 2. Add CratesCode Column to CratesTypes (2025-08-08)

```sql
ALTER TABLE [CratesTypes] ADD [CratesCode] nvarchar(max) NOT NULL DEFAULT '';
```

## 3. Modify CratesTypes Columns (2025-08-08)

```sql
-- First, remove the default constraint if it exists
DECLARE @var0 sysname;
SELECT @var0 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[CratesTypes]') AND [c].[name] = N'Cratestype');
IF @var0 IS NOT NULL EXEC(N'ALTER TABLE [CratesTypes] DROP CONSTRAINT [' + @var0 + '];');
ALTER TABLE [CratesTypes] ALTER COLUMN [Cratestype] nvarchar(50) NOT NULL;

-- Remove default constraint for CratesCode if it exists
DECLARE @var1 sysname;
SELECT @var1 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[CratesTypes]') AND [c].[name] = N'CratesCode');
IF @var1 IS NOT NULL EXEC(N'ALTER TABLE [CratesTypes] DROP CONSTRAINT [' + @var1 + '];');
ALTER TABLE [CratesTypes] ALTER COLUMN [CratesCode] nvarchar(1) NOT NULL;
```

## 4. Add CratesCode to MaterialMaster (2025-08-08)

```sql
ALTER TABLE [MaterialMaster] ADD [CratesCode] nvarchar(1) NOT NULL DEFAULT '';
```

## 5. Create Invoices and InvoiceMaterials Tables (2025-08-23)

```sql
CREATE TABLE [Invoices] (
    [InvoiceId] int NOT NULL IDENTITY,
    [InvoiceNo] nvarchar(50) NOT NULL,
    [InvoiceDate] datetime2 NOT NULL,
    [CustomerRefPO] nvarchar(50) NOT NULL,
    [TotalAmount] decimal(18,2) NOT NULL,
    [OrderDate] datetime2 NOT NULL,
    [BillToName] nvarchar(200) NOT NULL,
    [BillToCode] nvarchar(50) NOT NULL,
    [ShipToName] nvarchar(200) NOT NULL,
    [ShipToCode] nvarchar(50) NOT NULL,
    [ShipToRoute] nvarchar(100) NOT NULL,
    [CompanyName] nvarchar(200) NOT NULL,
    [CompanyCode] nvarchar(50) NOT NULL,
    [VehicleNo] nvarchar(50) NOT NULL,
    CONSTRAINT [PK_Invoices] PRIMARY KEY ([InvoiceId])
);

CREATE TABLE [InvoiceMaterials] (
    [MaterialId] int NOT NULL IDENTITY,
    [InvoiceId] int NOT NULL,
    [ProductDescription] nvarchar(200) NOT NULL,
    [MaterialSapCode] nvarchar(50) NOT NULL,
    [Batch] nvarchar(50) NULL,
    [UnitPerCase] int NOT NULL,
    [QuantityCases] int NOT NULL,
    [QuantityUnits] int NOT NULL,
    [UOM] nvarchar(20) NOT NULL,
    CONSTRAINT [PK_InvoiceMaterials] PRIMARY KEY ([MaterialId]),
    CONSTRAINT [FK_InvoiceMaterials_Invoices_InvoiceId] FOREIGN KEY ([InvoiceId]) REFERENCES [Invoices] ([InvoiceId]) ON DELETE CASCADE
);

CREATE INDEX [IX_InvoiceMaterials_InvoiceId_MaterialId] ON [InvoiceMaterials] ([InvoiceId], [MaterialId]);
CREATE INDEX [IX_Invoices_InvoiceId_ShipToCode_BillToCode_InvoiceDate_VehicleNo] ON [Invoices] ([InvoiceId], [ShipToCode], [BillToCode], [InvoiceDate], [VehicleNo]);
```

## 6. Create Dealer Master and Order Tables (2025-09-05)

```sql
CREATE TABLE [DealerMasters] (
    [Id] int NOT NULL IDENTITY,
    [DistributorId] int NOT NULL,
    [Name] nvarchar(200) NOT NULL,
    [RouteCode] nvarchar(50) NOT NULL,
    [Address] nvarchar(500) NOT NULL,
    [City] nvarchar(100) NOT NULL,
    [PhoneNo] nvarchar(10) NOT NULL,
    [Email] nvarchar(100) NOT NULL,
    CONSTRAINT [PK_DealerMasters] PRIMARY KEY ([Id])
);

CREATE TABLE [DealerBasicOrders] (
    [Id] int NOT NULL IDENTITY,
    [DealerId] int NOT NULL,
    [MaterialName] nvarchar(200) NOT NULL,
    [SapCode] nvarchar(50) NOT NULL,
    [ShortCode] nvarchar(50) NOT NULL,
    [Quantity] int NOT NULL,
    [BasicAmount] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_DealerBasicOrders] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_DealerBasicOrders_DealerMasters_DealerId] FOREIGN KEY ([DealerId]) REFERENCES [DealerMasters] ([Id]) ON DELETE CASCADE
);

CREATE INDEX [IX_DealerBasicOrders_DealerId] ON [DealerBasicOrders] ([DealerId]);
```

## 7. Add Default Value to Dealer Master Email (2025-09-05)

```sql
-- This migration was empty (no Up/Down operations)
```

## 8. Modify Dealer Master Email Default Value (2025-09-05)

```sql
-- Remove any existing default constraint
DECLARE @var2 sysname;
SELECT @var2 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[DealerMasters]') AND [c].[name] = N'Email');
IF @var2 IS NOT NULL EXEC(N'ALTER TABLE [DealerMasters] DROP CONSTRAINT [' + @var2 + '];');

-- Add new default value
ALTER TABLE [DealerMasters] ADD CONSTRAINT [DF_DealerMasters_Email] DEFAULT N'N/A' FOR [Email];
```

## 9. Remove Dealer Master Email Default Value (2025-09-05)

```sql
-- Remove the default constraint
DECLARE @var3 sysname;
SELECT @var3 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[DealerMasters]') AND [c].[name] = N'Email');
IF @var3 IS NOT NULL EXEC(N'ALTER TABLE [DealerMasters] DROP CONSTRAINT [' + @var3 + '];');
```

## 10. Make Dealer Master Email Nullable (2025-09-05)

```sql
-- Remove any existing default constraint
DECLARE @var4 sysname;
SELECT @var4 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[DealerMasters]') AND [c].[name] = N'Email');
IF @var4 IS NOT NULL EXEC(N'ALTER TABLE [DealerMasters] DROP CONSTRAINT [' + @var4 + '];');

-- Alter column to make it nullable
ALTER TABLE [DealerMasters] ALTER COLUMN [Email] nvarchar(100) NULL;
```

## 11. Create Dealer Orders Tables (2025-09-08)

```sql
CREATE TABLE [DealerOrders] (
    [Id] int NOT NULL IDENTITY,
    [OrderDate] datetime2 NOT NULL,
    [DistributorId] int NOT NULL,
    [DealerId] int NOT NULL,
    [DistributorCode] nvarchar(50) NOT NULL,
    [ProcessFlag] int NOT NULL,
    CONSTRAINT [PK_DealerOrders] PRIMARY KEY ([Id])
);

CREATE TABLE [DealerOrderItems] (
    [Id] int NOT NULL IDENTITY,
    [DealerOrderId] int NOT NULL,
    [MaterialName] nvarchar(200) NOT NULL,
    [ShortCode] nvarchar(10) NOT NULL,
    [SapCode] nvarchar(50) NOT NULL,
    [Qty] int NOT NULL,
    [Rate] decimal(18,2) NOT NULL,
    [Price] decimal(18,2) NOT NULL,
    CONSTRAINT [PK_DealerOrderItems] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_DealerOrderItems_DealerOrders_DealerOrderId] FOREIGN KEY ([DealerOrderId]) REFERENCES [DealerOrders] ([Id]) ON DELETE CASCADE
);

CREATE INDEX [IX_DealerOrderItems_DealerOrderId_SapCode_ShortCode] ON [DealerOrderItems] ([DealerOrderId], [SapCode], [ShortCode]);
CREATE INDEX [IX_DealerOrders_OrderDate_DealerId_DistributorId_ProcessFlag] ON [DealerOrders] ([OrderDate], [DealerId], [DistributorId], [ProcessFlag]);
```

## 12. Update Dealer Order Date Format (2025-09-08)

```sql
-- Change OrderDate column type from datetime2 to date
ALTER TABLE [DealerOrders] ALTER COLUMN [OrderDate] date NOT NULL;
```

## 13. Create Crates Management Table (2025-09-09)

```sql
CREATE TABLE [CratesManages] (
    [Id] int NOT NULL IDENTITY,
    [CustomerId] int NOT NULL,
    [SegmentCode] nvarchar(50) NOT NULL,
    [DispDate] datetime2 NOT NULL,
    [Opening] int NOT NULL,
    [Outward] int NOT NULL,
    [Inward] int NOT NULL,
    [Balance] int NOT NULL,
    CONSTRAINT [PK_CratesManages] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_CratesManages_Customer_Master_CustomerId] FOREIGN KEY ([CustomerId]) REFERENCES [Customer_Master] ([Id]) ON DELETE CASCADE
);

CREATE INDEX [IX_CratesManages_CustomerId] ON [CratesManages] ([CustomerId]);
```

## 14. Update Crates Management Date Format (2025-09-09)

```sql
-- Change DispDate column type from datetime2 to Date
ALTER TABLE [CratesManages] ALTER COLUMN [DispDate] date NOT NULL;
```

## 15. Add Crates Type ID to Crates Management (2025-09-10)

```sql
ALTER TABLE [CratesManages] ADD [CratesTypeId] int NULL;

CREATE INDEX [IX_CratesManages_CratesTypeId] ON [CratesManages] ([CratesTypeId]);

ALTER TABLE [CratesManages] ADD CONSTRAINT [FK_CratesManages_CratesTypes_CratesTypeId] FOREIGN KEY ([CratesTypeId]) REFERENCES [CratesTypes] ([Id]);
```

## 16. Add Sequence Column to Customer Master (2025-09-11)

```sql
ALTER TABLE [Customer_Master] ADD [Sequence] int NOT NULL DEFAULT 0;

CREATE INDEX [IX_CustomerMaster_Sequence] ON [Customer_Master] ([Sequence]);
```