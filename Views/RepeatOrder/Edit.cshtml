@model Milk_Bakery.Models.PurchaseOrder

@{
    ViewData["Title"] = "Edit";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string role = Context.Request.HttpContext.Session.GetString("role");
}


@if (role == "Customer")
{
    <div class="mt-1">
        <div class="card mb-1">
            <div class="card-header text-white p-1" style="background-color:#FC2947;">
                <div class="d-flex align-items-baseline">
                    <a href="/Home/Index" class="btn btn-link text-white"><i class="fa fa-arrow-left"></i></a>
                    <h5 class="mx-auto text-white text-2xl font-semibold">Repeat Order</h5>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <form asp-action="Create" id="CodeSbyAnizForm" onkeydown="return event.key != 'Enter';" ;>
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                            <input asp-for="OrderNo" class="form-control" hidden readonly />
                            <input asp-for="OrderDate" class="form-control" hidden readonly />
                            <input asp-for="Customername" class="form-control" hidden readonly />
                            <input asp-for="Segementname" class="form-control" hidden readonly />
                            <input asp-for="Segementcode" hidden class="form-control" readonly />
                            <input asp-for="CustomerCode" hidden class="form-control"  readonly />
@*
                            <div class="row">
                                <div class="form-group col-sm-6">
                                   
                                    <label asp-for="Customername" class="control-label"></label>
                                   
                                    <span asp-validation-for="Customername" class="text-danger"></span>
                                </div>
                                <div class="form-group col-sm-6">
                                    <label asp-for="Segementname" class="control-label"></label>
                                  
                                    <span asp-validation-for="Segementname" class="text-danger"></span>
                                   

                                </div>
                            </div>*@
                            <div class="vertical-scrollable-div">
                            @for (int i = 0; i < Model.ProductDetails.Count; i++)
                            {
                                if (@Model.ProductDetails[i].qty > 0)
                                {
                                    <div class="row bg-blue-100">
                                        <div class="col-12"> <span class="pl-1"><input asp-for="@Model.ProductDetails[i].ProductName" class="border-0 bg-transparent font-weight-bold w-100 text-capitalize text-dark p-0" readonly /></span></div>
                                        <div class="col-6">
                                            <span class="pl-1">Unit : <input asp-for="@Model.ProductDetails[i].Unit" class="border-0 bg-transparent text-dark w-50 p-0" readonly /></span>
                                            <span class="pl-1">Rate : <input asp-for="@Model.ProductDetails[i].Rate" class="border-0 bg-transparent text-dark w-50 p-0" readonly /></span>

                                        </div>
                                        <div class="col-6">
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <button class="btn hover:bg-red-700 bg-red-600 decrement-btn text-white" type="button" style="border-top-left-radius:50%;border-bottom-left-radius:50%">-</button>
                                                </div>
                                                <input type="number" asp-for="@Model.ProductDetails[i].qty" class="form-control border-danger w-25 number-input QtyTotal" dir="rtl" min="0" maxlength="4">
                                                <div class="input-group-append">
                                                    <button class="btn hover:bg-red-700 bg-red-600 increment-btn text-white" type="button" style="border-top-right-radius:50%;border-bottom-right-radius:50%">+</button>
                                                    <input type="hidden" asp-for="@Model.ProductDetails[i].Price" class="form-control" readonly />
                                                    <input type="hidden" asp-for="@Model.ProductDetails[i].IsDeleted" />
                                                    <input asp-for="@Model.ProductDetails[i].ProductCode" class="form-control" type="hidden" readonly />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr class="m-1">
                                }
                                else
                                {
                                    <div class="row">
                                        <div class="col-12"> <span class="pl-1"><input asp-for="@Model.ProductDetails[i].ProductName" class="border-0 bg-transparent font-weight-bold w-100 text-capitalize text-dark p-0" readonly /></span></div>
                                        <div class="col-6">
                                            <span class="pl-1">Unit : <input asp-for="@Model.ProductDetails[i].Unit" class="border-0 bg-transparent text-dark w-50 p-0" readonly /></span>
                                            <span class="pl-1">Rate : <input asp-for="@Model.ProductDetails[i].Rate" class="border-0 bg-transparent text-dark w-50 p-0" readonly /></span>

                                        </div>
                                        <div class="col-6">
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <button class="btn hover:bg-red-700 bg-red-600 decrement-btn text-white" type="button" style="border-top-left-radius:50%;border-bottom-left-radius:50%">-</button>
                                                </div>
                                                <input type="number" asp-for="@Model.ProductDetails[i].qty" class="form-control border-danger w-25 number-input QtyTotal" dir="rtl" min="0" maxlength="4">
                                                <div class="input-group-append">
                                                    <button class="btn hover:bg-red-700 bg-red-600 increment-btn text-white" type="button" style="border-top-right-radius:50%;border-bottom-right-radius:50%">+</button>
                                                    <input type="hidden" asp-for="@Model.ProductDetails[i].Price" class="form-control" readonly />
                                                    <input type="hidden" asp-for="@Model.ProductDetails[i].IsDeleted" />
                                                    <input asp-for="@Model.ProductDetails[i].ProductCode" class="form-control" type="hidden" readonly />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr class="m-1">
                                }

                            }
                            </div>

                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <th style="font-size:12px">
                                                Total Quantity:
                                            </th>
                                            <th style="width:150px">
                                                <input type="text" id="txtQtyTotal" class="form-control" value="" readonly />
                                            </th>

                                            <th style="font-size:12px">
                                                Total Amount:
                                            </th>



                                            <th style="width:230px">
                                                <input type="text" id="txtAmountTotal" class="form-control" value="" readonly />
                                            </th>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                              
                            <br />
                            <div class="px-4 text-right py-2">
                                <a asp-action="Index" class="btn hover:bg-red-700 bg-red-600  rounded-sm shadow-md text-white mt-1">Back</a>
                                <input type="submit" value="Save Order" class="btn hover:bg-blue-700 bg-blue-600 rounded-sm shadow-md text-white mt-1" onclick="return confirmation1(this);" />


                               
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else if (role=="Sales")
{
    <div class="mt-1">
        <div class="card mb-1">
            <div class="card-header text-white p-1" style="background-color:#FC2947;">
                <div class="d-flex align-items-baseline">
                    <a href="/Home/Index" class="btn btn-link text-white"><i class="fa fa-arrow-left"></i></a>
                    <h5 class="mx-auto text-white text-2xl font-semibold">Repeat Order</h5>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <form asp-action="Create" id="CodeSbyAnizForm" onkeydown="return event.key != 'Enter';" ;>
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                            <input asp-for="OrderNo" class="form-control" hidden readonly />
                            <input asp-for="OrderDate" class="form-control" hidden readonly />
                            <input asp-for="Customername" class="form-control" hidden readonly />
                            <input asp-for="Segementname" class="form-control" hidden readonly />
                            <input asp-for="Segementcode" hidden class="form-control" readonly />
                            <input asp-for="CustomerCode" hidden class="form-control" readonly />
                            @*
                        <div class="row">
                        <div class="form-group col-sm-6">

                        <label asp-for="Customername" class="control-label"></label>

                        <span asp-validation-for="Customername" class="text-danger"></span>
                        </div>
                        <div class="form-group col-sm-6">
                        <label asp-for="Segementname" class="control-label"></label>

                        <span asp-validation-for="Segementname" class="text-danger"></span>


                        </div>
                        </div>*@
                            <div class="vertical-scrollable-div">
                            @for (int i = 0; i < Model.ProductDetails.Count; i++)
                            {
                                if (@Model.ProductDetails[i].qty > 0)
                                {
                                    <div class="row bg-blue-100">
                                        <div class="col-12"> <span class="pl-1"><input asp-for="@Model.ProductDetails[i].ProductName" class="border-0 bg-transparent font-weight-bold w-100 text-capitalize text-dark p-0" readonly /></span></div>
                                        <div class="col-6">
                                            <span class="pl-1">Unit : <input asp-for="@Model.ProductDetails[i].Unit" class="border-0 bg-transparent text-dark w-50 p-0" readonly /></span>
                                            <span class="pl-1">Rate : <input asp-for="@Model.ProductDetails[i].Rate" class="border-0 bg-transparent text-dark w-50 p-0" readonly /></span>

                                        </div>
                                        <div class="col-6">
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <button class="btn hover:bg-red-700 bg-red-600 decrement-btn text-white" type="button" style="border-top-left-radius:50%;border-bottom-left-radius:50%">-</button>
                                                </div>
                                                <input type="number" asp-for="@Model.ProductDetails[i].qty" class="form-control border-danger w-25 number-input QtyTotal" dir="rtl" min="0" maxlength="4">
                                                <div class="input-group-append">
                                                    <button class="btn hover:bg-red-700 bg-red-600 increment-btn text-white" type="button" style="border-top-right-radius:50%;border-bottom-right-radius:50%">+</button>
                                                    <input type="hidden" asp-for="@Model.ProductDetails[i].Price" class="form-control" readonly />
                                                    <input type="hidden" asp-for="@Model.ProductDetails[i].IsDeleted" />
                                                    <input asp-for="@Model.ProductDetails[i].ProductCode" class="form-control" type="hidden" readonly />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr class="m-1">
                                }
                                else
                                {
                                    <div class="row">
                                        <div class="col-12"> <span class="pl-1"><input asp-for="@Model.ProductDetails[i].ProductName" class="border-0 bg-transparent font-weight-bold w-100 text-capitalize text-dark p-0" readonly /></span></div>
                                        <div class="col-6">
                                            <span class="pl-1">Unit : <input asp-for="@Model.ProductDetails[i].Unit" class="border-0 bg-transparent text-dark w-50 p-0" readonly /></span>
                                            <span class="pl-1">Rate : <input asp-for="@Model.ProductDetails[i].Rate" class="border-0 bg-transparent text-dark w-50 p-0" readonly /></span>

                                        </div>
                                        <div class="col-6">
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <button class="btn hover:bg-red-700 bg-red-600 decrement-btn text-white" type="button" style="border-top-left-radius:50%;border-bottom-left-radius:50%">-</button>
                                                </div>
                                                <input type="number" asp-for="@Model.ProductDetails[i].qty" class="form-control border-danger w-25 number-input QtyTotal" dir="rtl" min="0" maxlength="4">
                                                <div class="input-group-append">
                                                    <button class="btn hover:bg-red-700 bg-red-600 increment-btn text-white" type="button" style="border-top-right-radius:50%;border-bottom-right-radius:50%">+</button>
                                                    <input type="hidden" asp-for="@Model.ProductDetails[i].Price" class="form-control" readonly />
                                                    <input type="hidden" asp-for="@Model.ProductDetails[i].IsDeleted" />
                                                    <input asp-for="@Model.ProductDetails[i].ProductCode" class="form-control" type="hidden" readonly />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr class="m-1">
                                }
                            }
                            </div>

                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <th style="font-size:12px">
                                                Total Quantity:
                                            </th>
                                            <th style="width:150px">
                                                <input type="text" id="txtQtyTotal" class="form-control" value="" readonly />
                                            </th>

                                            <th style="font-size:12px">
                                                Total Amount:
                                            </th>



                                            <th style="width:230px">
                                                <input type="text" id="txtAmountTotal" class="form-control" value="" readonly />
                                            </th>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <br />
                            <div class="px-4 text-right py-2">
                                <a asp-action="Index" class="btn hover:bg-red-700 bg-red-600  rounded-sm shadow-md text-white mt-1">Back</a>
                                <input type="submit" value="Save Order" class="btn hover:bg-blue-700 bg-blue-600 rounded-sm shadow-md text-white mt-1" onclick="return confirmation1(this);" />


                        
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="mt-3">
        <div class="card mb-3">
            <div class="card-header text-white p-1" style="background-color:#FC2947;">
                <div class="d-flex align-items-baseline">
                    <a href="/Home/Index" class="btn btn-link text-white"><i class="fa fa-arrow-left"></i></a>
                    <h5 class="mx-auto text-white text-2xl font-semibold">Repeat Order</h5>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <form asp-action="Create" id="CodeSbyAnizForm"  onkeydown="return event.key != 'Enter';">
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                            <input type="hidden" asp-for="Id" />

                            <div class="md:grid grid-cols-12 flex flex-col md:items-center gap-4 p-2">

                                <div class="col-span-4 relative">
                                    <span class="absolute bg-white left-3 -top-[12px] px-2">Order No</span>
                                    <input class="text-[13px] h-10 text-gray-700 bg-light w-full border-2 px-2 rounded-sm text-right" asp-for="OrderNo" readonly />
                                </div>
                                <div class="col-span-4 relative">
                                    <span class="absolute bg-white left-3 -top-[12px] px-2">Customer</span>
                                    <input class="text-[13px] h-10 text-gray-700 bg-light w-full border-2 px-2 rounded-sm text-right" asp-for="Customername" readonly />
                                    <input asp-for="OrderDate" class="form-control" readonly hidden />
                                    <input asp-for="Segementname" class="form-control" readonly hidden />
                                    <input asp-for="CustomerCode" class="form-control" readonly hidden />
                                    <input asp-for="Segementcode" class="form-control" hidden />
                                </div>

                            </div>


                            <div class="w-screen-lg  mt-2">
                                <div class="table-responsive table-container max-h-60  overflow-y-auto">
                                    <table class="w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-200 sticky top-0 text-center">
                                            <tr>
                                                <th>Product Name</th>
                                                <th>Code</th>
                                                <th>Quantity</th>
                                                <th>Unit</th>
                                                <th>Rate</th>
                                                <th>Amount</th>
                                                @* <th style="width:100px;">
                                            <button id='btnAddDetailRow' type="button" class="btn btn-sm btn-secondary visible" onclick="AddItem(this)">
                                            Add
                                            </button>
                                            </th>*@
                                            </tr>
                                        </thead>

                                        <tbody id="CsDiv">

                                            @for (int i = 0; i < Model.ProductDetails.Count; i++)
                                            {
                                                if (@Model.ProductDetails[i].qty > 0)
                                                {
                                                    <tr>
                                                        <td style="width:300px">

                                                            <input asp-for="@Model.ProductDetails[i].ProductName" class="form-control" readonly />
                                                            <span asp-validation-for="@Model.ProductDetails[i].ProductName" class="text-danger"></span>
                                                        </td>

                                                        <td>
                                                            <input asp-for="@Model.ProductDetails[i].ProductCode" class="form-control" readonly />
                                                            <span asp-validation-for="@Model.ProductDetails[i].ProductCode" class="text-danger"></span>
                                                        </td>
                                                        <td style="width:80px">
                                                            <input asp-for="@Model.ProductDetails[i].qty" class="form-control QtyTotal text-right " type="text" />
                                                            <span asp-validation-for="@Model.ProductDetails[i].qty" class="text-danger"></span>
                                                        </td>
                                                        <td>
                                                            <input asp-for="@Model.ProductDetails[i].Unit" class="form-control text-right" readonly />
                                                            <span asp-validation-for="@Model.ProductDetails[i].Unit" class="text-danger"></span>
                                                        </td>

                                                        <td>
                                                            <input asp-for="@Model.ProductDetails[i].Rate" class="form-control text-right" readonly />
                                                            <span asp-validation-for="@Model.ProductDetails[i].Rate" class="text-danger"></span>
                                                        </td>

                                                        <td>
                                                            <input asp-for="@Model.ProductDetails[i].Price" class="form-control text-right" readonly />
                                                            <input type="hidden" asp-for="@Model.ProductDetails[i].IsDeleted" />
                                                        </td>
                                                        @* <td>
                                            <button id='btnremove-@i' type="button" class="btn btn-sm btn-danger visible" onclick="DeleteItem(this)">
                                            Delete
                                            </button>
                                            </td>*@
                                                    </tr>
                                                }
                                                else
                                                {
                                                    <tr class="bg-blue-100">
                                                        <td style="width:300px">

                                                            <input asp-for="@Model.ProductDetails[i].ProductName" class="form-control" readonly />
                                                            <span asp-validation-for="@Model.ProductDetails[i].ProductName" class="text-danger"></span>
                                                        </td>

                                                        <td>
                                                            <input asp-for="@Model.ProductDetails[i].ProductCode" class="form-control" readonly />
                                                            <span asp-validation-for="@Model.ProductDetails[i].ProductCode" class="text-danger"></span>
                                                        </td>
                                                        <td style="width:80px">
                                                            <input asp-for="@Model.ProductDetails[i].qty" class="form-control QtyTotal text-right " type="text" />
                                                            <span asp-validation-for="@Model.ProductDetails[i].qty" class="text-danger"></span>
                                                        </td>
                                                        <td>
                                                            <input asp-for="@Model.ProductDetails[i].Unit" class="form-control text-right" readonly />
                                                            <span asp-validation-for="@Model.ProductDetails[i].Unit" class="text-danger"></span>
                                                        </td>

                                                        <td>
                                                            <input asp-for="@Model.ProductDetails[i].Rate" class="form-control text-right" readonly />
                                                            <span asp-validation-for="@Model.ProductDetails[i].Rate" class="text-danger"></span>
                                                        </td>

                                                        <td>
                                                            <input asp-for="@Model.ProductDetails[i].Price" class="form-control text-right" readonly />
                                                            <input type="hidden" asp-for="@Model.ProductDetails[i].IsDeleted" />
                                                        </td>
                                                        @* <td>
                                            <button id='btnremove-@i' type="button" class="btn btn-sm btn-danger visible" onclick="DeleteItem(this)">
                                            Delete
                                            </button>
                                            </td>*@
                                                    </tr>
                                                }

                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="table-wrapper">
                                <table class="responsive-table table text-center m-0 p-0">
                                    <tbody>
                                        <tr>
                                            <th width="180px">Total Item in Cart:</th>
                                            <th width="80px"><input class="text-right form-control" value="@Model.ProductDetails.Count()" readonly /></th>
                                            <th width="180px">
                                                Total Quantity:
                                            </th>
                                            <th style="width:100px">
                                                <input type="text" id="txtQtyTotal" class="form-control text-right" readonly />
                                            </th>

                                            <th style="width:120px">
                                                Total Amount:
                                            </th>



                                            <th style="width:120px">
                                                <input type="text" id="txtAmountTotal" class="form-control text-right" readonly />
                                            </th>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br />
                            <div class="px-4 text-right py-2">
                                <a asp-action="Index" class="btn hover:bg-red-700 bg-red-600  rounded-sm shadow-md text-white mt-1">Back</a>
                                <input type="submit" value="Save Order" class="btn hover:bg-blue-700 bg-blue-600 rounded-sm shadow-md text-white mt-1" onclick="return confirmation1(this);" />
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

}




<script>
    CalcTotals();
    function CalcTotals() {
        console.log("hi");
        var x = document.getElementsByClassName('QtyTotal');


        var totalQty = 0;
        var Amount = 0;
        var totalAmount = 0;



        var i;

        for (i = 0; i < x.length; i++) {

            var idofIsDeleted = i + "__IsDeleted";

            var idofPrice = i + "__Rate";


            var idofTotal = i + "__Price";

            var hidIsDelId = document.querySelector("[id$='" + idofIsDeleted + "']").id;

            var priceTxtId = document.querySelector("[id$='" + idofPrice + "']").id;

            var totalTxtId = document.querySelector("[id$='" + idofTotal + "']").id;


            if (document.getElementById(hidIsDelId).value != "true") {
                totalQty = totalQty + eval(x[i].value);

                var txttotal = document.getElementById(totalTxtId);
                var txtprice = document.getElementById(priceTxtId);
                txttotal.value = (eval(x[i].value) * txtprice.value).toFixed(2);

                totalAmount = eval(totalAmount) + eval(txttotal.value);
            }
        }

        document.getElementById('txtQtyTotal').value = totalQty;
        document.getElementById('txtAmountTotal').value = totalAmount.toFixed(2);

    }
</script>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
