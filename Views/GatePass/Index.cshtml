@model Milk_Bakery.ViewModels.GatePassIndexViewModel

@{
    ViewData["Title"] = "Gate Pass";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="mt-3">
    <div class="card mb-3">
        <div class="card-header bg-blue-500 text-white">
            <div class="d-flex align-items-baseline">
                <h5 class="mx-auto text-white text-2xl font-semibold">Gate Pass</h5>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-hover table-sm" id="gatePassTable" width="100%" cellspacing="0">
                    <thead class="thead-dark">
                        <tr>
                            <th>Truck Number</th>
                            <th>Dispatch Date</th>
                            <th>Total Customer Count</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.GroupedData != null && Model.GroupedData.Any())
                        {
                            @foreach (var item in Model.GroupedData)
                            {
                                <tr>
                                    <td>@item.TruckNumber</td>
                                    <td>@item.DispatchDate.ToString("dd/MM/yyyy")</td>
                                    <td>@item.CustomerCount</td>
                                    <td>
                                        <a href="@Url.Action("PrintGatePass", "GatePass", new { truckNumber = item.TruckNumber, date = item.DispatchDate.ToString("yyyy-MM-dd") })" 
                                           class="btn btn-primary btn-sm">
                                            <i class="fas fa-print"></i> Print Gate Pass
                                        </a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <!-- Ensure we have the same number of cells even when no data -->
                            <tr>
                                <td colspan="4" class="text-center">No gate pass data available</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Destroy any existing DataTable instance first to avoid conflicts
            if ($.fn.DataTable.isDataTable("#gatePassTable")) {
                $("#gatePassTable").DataTable().destroy();
            }
            
            // Initialize with a small delay to ensure no other scripts interfere
            setTimeout(function() {
                $('#gatePassTable').DataTable({
                    "pageLength": 25,
                    "columnDefs": [
                        { "orderable": false, "targets": [3] } // Disable sorting on Action column
                    ]
                });
            }, 100);
        });
    </script>
}